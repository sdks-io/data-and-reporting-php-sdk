<?php

declare(strict_types=1);

/*
 * ShellDataReportingAPIsLib
 *
 * This file was automatically generated by APIMATIC v3.0 ( https://www.apimatic.io ).
 */

namespace ShellDataReportingAPIsLib\Tests\Controllers;

use Core\TestCase\BodyMatchers\KeysBodyMatcher;
use Core\TestCase\TestParam;
use ShellDataReportingAPIsLib\Controllers\TransactionController;
use ShellDataReportingAPIsLib\Exceptions;
use ShellDataReportingAPIsLib\Models;

class TransactionControllerTest extends BaseTestController
{
    /**
     * @var TransactionController TransactionController instance
     */
    protected static $controller;

    /**
     * Setup test class
     */
    public static function setUpBeforeClass(): void
    {
        self::$controller = parent::getClient()->getTransactionController();
    }

    public function testRecentTransactionsNew()
    {
        // Parameters for the API call
        $requestId = '2b0cbe11-f109-4c43-9201-49af0370df1c';
        $body = TestParam::object(
            '{"PageSize":1,"Page":1,"Filters":{"ColCoCode":14,"PayerNumber":"GB00001232","Accou' .
            'ntNumber":"GB00001233","ProductCode":"22","PurchasedInCountry":"GB","CardPAN":"7002' .
            '05******890645","FromDateTime":"2020-11-09 13:56:03.000","ToDateTime":"2020-12-09 1' .
            '3:56:03.000","TransactionStatus":"APPROVED","FuelOnly":"False","ProductGroupName":"' .
            'Motor gasoline","VehicleRegistrationNumber":"YG67OUM","IncludeDeclines":true,"CardI' .
            'ssuerName":"Mathew","ColumnList":"PayerNumber,AccountNumber,ProductName,FuelVolume,' .
            'PAN"}}',
            Models\RecentTransactionRequest::class
        );

        // Perform API call
        $result = null;
        try {
            $result = self::$controller->recentTransactionsNew($requestId, $body);
        } catch (Exceptions\ApiException $e) {
        }

        $headers = [];
        $headers['Content-Type'] = ['application/json', true];

        // Assert result with expected response
        $this->newTestCase($result)
            ->expectStatus(200)
            ->allowExtraHeaders()
            ->expectHeaders($headers)
            ->bodyMatcher(KeysBodyMatcher::init(TestParam::object(
                '{"RequestId":"9d2dee33-7803-485a-a2b1-2c7538e597ee","Status":"SUCCESS","Page":' .
                '1,"RowCount":2,"TotalPages":1,"Data":[{"ColCoCode":84,"PayerNumber":"MY00200653' .
                '","AccountNumber":"MY00200653","CardIssueNumber":"1","CollectingCompanyCurrency' .
                'Code":"MYR","CustDataCustomerEntered":"PartnerId","CustDataDriverId":"D123","Cu' .
                'stDataFleetDescription":"Fleet-Truck","FleetIdInput":"AS2344","Amount":62.47,"E' .
                'uroshellSiteNumber":"1231","IncomingProductCode":"10","ProductCode":"23","Produ' .
                'ctName":"Unleaded - Low octane","SiteCode":3350,"HostingCollectingCompanyName":' .
                '"Shell Malaysia Trading Sdn Bhd","HostingCollectingCompanyNumber":"84","Iccdata' .
                'TranTypeCode":"1","TransactionType":"Transaction Type description","Latitude":"' .
                '52.143814","Longitude":"101.72869","MerchantCategory":"5542","MerchantCategoryD' .
                'escription":"Description","PurchasedInCountry":"MY","MerchantId":"MY17370000000' .
                '00","SiteName":"ShellPT3895 BATU 4    KUALA LUMPUR MY","Network":"458","DelcoCo' .
                'de":"084","OdometerInput":"201620","OdometerReadingKm":"201620","OdometerReadin' .
                'gMiles":"201620","CardPAN":"700214*******780061","PINIndicator":"Y","POIReceipt' .
                'Number":"417662","ProductsCodeAdditional":"Additional Code","ProductsTaxCode":"' .
                '0","FuelVolume":34.15,"SfgwCardDateOfExpiry":"2024-12","SiteCurrencyISOCode":"M' .
                'YR","CardId":"330743","TransactionDate":"2021-11-11","TransactionDateTime":"202' .
                '1-11-11 16:32:09.000","TransactionId":"864220307","TransactionStatus":"Approved' .
                '","UnitOfMeasure":"L","VehicleRegistrationNumber":"WD33637","NetworkDelcoName":' .
                '"Shell Malaysia Trading Sdn Bhd","ProductGroupName":"Motor gasoline","FuelProdu' .
                'ct":"All Fuels","AccountCustomerName":"WCT BERHAD","PayerName":"WCT BERHAD","Tr' .
                'ansactionTime":"2021-11-11","TransactionCurrency":"RM","UnitPrice":0.0205007320' .
                '6442167,"AuthorisedFlag":"Y","TransactionTimeGMT":"08:41:02","ReasonCode":"10",' .
                '"IssuerActionCode":"2","IssuerActionCodeDescription":"Approved, partial","Decli' .
                'nedReason":"partial","CardStatusReasonDescription":"Approved, partial","Transac' .
                'tionCountry":"458","IssuingCollectingCompanyName":"Partner Name","CardIssuerNam' .
                'e":"John","DriverName":"PAK PAK","BearerDescription":"Description","CardCategor' .
                'yDescription":"Driver Card","CardTypeDescription":"SHELL FLEET- HONG KONG 70028' .
                '21","CardTokenTypeDescription":"HK FLE NAT SIN R1 - CHIP","EmbossType":"Driver"' .
                ',"EVPrintedNumber":"NL-TNM-C00122045-K","IsRFID":false}]}'
            )))
            ->assert();
    }

    public function testPricedTransactionsV2()
    {
        // Parameters for the API call
        $requestId = '2b0cbe11-f109-4c43-9201-49af0370df1c';
        $body = TestParam::object(
            '{"PageSize":1,"Page":1,"Filters":{"ColCoCode":"032","InvoiceStatus":"A","PayerNumb' .
            'er":"DE26685263","AccountId":29484,"AccountNumber":"DE26667080","DriverName":"HH NX' .
            ' 508","CardGroupId":40000,"CardPAN":"7002051006629890645","ProductCode":"10","Produ' .
            'ctName":"Diesel AGO","SiteCode":"05000100","IncomingSiteNumber":"100021","InvoiceDa' .
            'te":"2021-01-01","InvoiceNumber":"3201016193","PurchasedInCountryCode":"GB","Purcha' .
            'sedInCountry":"United Kingdom","SiteGroupId":202,"VehicleRegistrationNumber":"4K468' .
            '01","FeeTypeId":275549,"LineItemDescription":"ABC3","Cards":[0],"SortOrder":"5","Fr' .
            'omDate":"2022-01-01 00:00:00","ToDate":"2022-01-01 00:00:00","Period":3,"PostingDat' .
            'eFrom":"2022-01-01 00:00:00","PostingDateTo":"2022-01-01 00:00:00","TransactionItem' .
            'Id":"1208176398","FuelOnly":false,"IncludeFees":true,"IsMultipayer":true,"ValidInvo' .
            'iceDateOnly":false,"InvoiceFromDate":"2022-01-01 00:00:00","InvoiceToDate":"2022-01' .
            '-01 00:00:00","HostingCollectingCompanyNumber":"032","Search":"2K89909","Transactio' .
            'nId":"io9KVXk1UkW57XWKyeaHHg"}}',
            Models\PricedTransactionRequestV2::class
        );

        // Perform API call
        $result = null;
        try {
            $result = self::$controller->pricedTransactionsV2($requestId, $body);
        } catch (Exceptions\ApiException $e) {
        }

        $headers = [];
        $headers['Content-Type'] = ['application/json', true];

        // Assert result with expected response
        $this->newTestCase($result)
            ->expectStatus(200)
            ->allowExtraHeaders()
            ->expectHeaders($headers)
            ->bodyMatcher(KeysBodyMatcher::init(TestParam::object(
                '{"RequestId":"9d2dee33-7803-485a-a2b1-2c7538e597ee","Status":"SUCCESS","Data":' .
                '[{"AccountName":"Blue Colour Ltd","AccountId":29484,"AccountNumber":"DE26667080' .
                '","AccountShortName":"Mathew","Additional1":"GBALLEGO0002452","Additional2":"GB' .
                'ALLEGO0002452","Additional3":"GBALLEGO0002452","Additional4":"GBALLEGO0002452",' .
                '"AllowClearing":"Null","AuthorisationCode":300796,"TransactionStatus":"Y","Driv' .
                'erName":"SATTY BHAMRA","CardExpiryPeriod":2204,"CardExpiry":"20220101","CardGro' .
                'upId":40000,"CardGroupName":"006240 FIRE BRIGHT SOLUTIONS","IssuerCode":7002,"C' .
                'ardPAN":"7002053465789891000","ReleaseCode":9,"CardSequenceNumber":617,"CardTyp' .
                'e":"GB STD FLT NAT SINGLE R9","ColCoCode":"014","UnitDiscountInvoiceCurrency":-' .
                '0.0051,"ColCoExchangeRate":0.851858,"InvoiceCurrencySymbol":"GBP","CorrectionFl' .
                'ag":true,"CRMNumber":10,"CustomerCountry":"United Kingdom","CustomerCurrencyCod' .
                'e":"GBP","CustomerCurrencySymbol":"Â£","RebateonNetAmountInCustomerCurrency":0,"' .
                'EffectiveDiscountInCustomerCurrency":-0.22,"EffectiveUnitDiscountInCustomerCurr' .
                'ency":-0.0051,"UnitPriceInInvoiceCurrency":1.1024,"InvoiceTax":0,"InvoiceGrossA' .
                'mount":57.25,"InvoiceNetAmount":47.71,"VATonNetAmountInCustomerCurrency":9.54,"' .
                'CustomerRetailPriceUnitGross":0,"CustomerRetailValueTotalGross":57.52,"Customer' .
                'RetailValueTotalNet":47.93,"TransactionTypeDescription":9.59,"RebateonNetAmount' .
                'InTransactionCurrency":-0.22,"EffectiveDiscountInTrxCurrency":-0.22,"DelCoToCol' .
                'CoExchangeRate":0,"Cards":[275549],"UnitDiscountTransactionCurrency":-0.005,"Tr' .
                'ansactionGrossAmount":57.25,"TransactionNetAmount":47.71,"TransactionTax":9.54,' .
                '"VATonNetAmount":9.54,"DelcoListPriceUnitNet":0,"DelcoRetailPriceUnitGross":1.3' .
                '2888,"UnitPriceInTransactionCurrency":1.1074,"DelcoRetailPriceUnitNet":1.1074,"' .
                'DelcoRetailValueTotalGross":57.52,"DelcoRetailValueTotalNet":47.93,"Transaction' .
                'CurrencySymbol":"$","DiscountType":"Retail","DisputeStatus":false,"IsShellSite"' .
                ':false,"FleetIdInput":"YG67OUM","IncomingProductCode":23,"PostingDate":"2021080' .
                '2","PostingTime":"14:15:22","ProductCode":30,"ProductName":"Unleaded - Medium o' .
                'ctane","ProductGroupId":22,"IncomingCurrencyCode":"GBP","IncomingSiteDescriptio' .
                'n":"Shell Broadway Ring","Location":"Shell Broadway Ring","SiteName":"Shell Bro' .
                'adway Ring","SiteCode":32,"IncomingSiteNumber":15,"InvoiceCurrencyCode":"GBP","' .
                'InvoiceDate":"20210802","InvoiceNumber":3201016193,"FuelProduct":true,"VATAppli' .
                'cable":"Y","PayerName":"Colours Services Ltd","PayerNumber":"GB12121212","Paren' .
                'tCustomerNumber":"GB12121212","PayerGroup":"H312066","PayerGroupName":"12162566' .
                ' - FUEL CARD SERVICE","CheckDigit":6,"NetInvoiceIndicator":"Y","DelcoCode":5,"N' .
                'etworkCode":3,"PurchasedInCountry":"United Kingdom","SiteCountry":"United Kingd' .
                'om","VATCountry":"United Kingdom","DelcoName":"Shell U.K. Oil Products Limited"' .
                ',"Network":"Shell","OdometerInput":0,"OriginalSalesItemId":"Null","FleetIDDescr' .
                'iption":"YG67OUM","ParentCustomerId":6494,"PINIndicator":"Y, N","ProductGroupNa' .
                'me":"Fees","PurchasedInCountryCode":"GB","Quantity":43.28,"RebateRate":0.0022,"' .
                'ReceiptNumber":6803,"RefundFlag":"Y","SiteGroupId":202,"SiteGroupName":"CZ 9100' .
                ' ECONOMY NETWORK","Latitude":53.83606,"Longitude":-1.61854,"DelCoExchangeRate":' .
                '0.851858,"EuroRebateAmount":-0.258259,"NetEuroAmount":56.01,"EuroVATAmount":11.' .
                '2,"ParentCustomerName":"FUEL CARD SERVICES LTD","IsInvoiced":false,"Transaction' .
                'CurrencyCode":"GBP","CreditDebitCode":"D or C","TransactionDate":"20210801","Tr' .
                'ansactionTime":"12:16:58","TransactionItemId":"H305908971030","TrnIdentifier":"' .
                'H305908971030","Type":"SALE","TransactionLine":1,"TransactionType":"Purchase","' .
                'UTCOffset":"Europe/London","VATCategory":"United Kingdom Standard VAT Rate","VA' .
                'TRate":0.2,"VehicleRegistration":"YG67OUM","IsCancelled":"Y","ColCoGrossAmount"' .
                ':57.25,"ColCoNetAmount":47.71,"ColCoVATAmount":9.54,"OriginalCurrencySymbol":"$' .
                '","OriginalCurrencyCode":"$","OriginalVATAmount":0,"EmbossText":"PARKLANE PROPE' .
                'RTIES LTD","OriginalExchangeRate":0,"OriginalTransactionItemInvoiceDate":"20220' .
                '202","FeeTypeId":1,"LineItemDescription":true,"FeeRuleDescription":"Simple Fee"' .
                ',"Frequency":1,"FeeRuleId":1,"SystemEntryDate":"20210828","SystemEntryTime":"20' .
                ':21:08","IsManual":"Y","OriginalTransactionItemId":"Y","OriginalTransactionItem' .
                'InvoiceNumber":6750802,"OriginalTransactionItemInvoiceId":234,"PayerShortName":' .
                '"FUEL CARD SERVICES LTD","ReverseCharge":"Y","OriginalGrossAmount":57.25,"Origi' .
                'nalNetAmount":57.25,"UnitOfMeasure":"L","RoadType":"National Road","CustomerCou' .
                'ntryIsoCode":"DE","EVOperator":"Shell Recharge","EVSerialId":"GBALLEGO0002452",' .
                '"EVChargePointSerial":"GBALLEGO0002452","EVChargePointConnectorType":5,"EVCharg' .
                'ePointConnectorTypeDescription":"DC 50 kW","EVChargeDuration":"PT3205S","EVChar' .
                'geStartDate":"2021-08-01","EVChargeStartTime":"20:08:01","EVChargeEndDate":"202' .
                '2-08-01","EVChargeEndTime":"20:08:01","HostingCollectingCompanyNumber":0,"Trans' .
                'actionId":0,"FuelOnly":true}],"Page":3,"PageSize":30,"TotalPages":5}'
            )))
            ->assert();
    }
}
